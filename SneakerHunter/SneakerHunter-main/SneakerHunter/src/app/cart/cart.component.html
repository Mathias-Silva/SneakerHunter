<section class="cart-page">
  <h2>Carrinho</h2>
  <div *ngIf="(items$ | async) as items; else empty">
    <p *ngIf="!items?.length">Nenhum Produto no carrinho.</p>

    <div *ngFor="let e of items" class="cart-row">
      <img [src]="e.item?.image || e.item?.imageUrl" alt="{{ e.item?.name }}" class="thumb"/>
      <div><strong>{{ e.item?.name }}</strong></div>
      <div>Preço unit.: R$ {{ e.item?.price | number:'1.2-2' }}</div>
      <div>Subtotal: R$ {{ ((e.item?.price || 0) * (e.qty || 0)) | number:'1.2-2' }}</div>

      <div class="qty-controls">
        <button (click)="decrease(e)" title="Diminuir">-</button>
        <input type="number" min="1" [value]="e.qty"
               (change)="setQty(e.item?.id ?? e, $any($event.target).valueAsNumber)" />
        <button (click)="increase(e)" title="Aumentar">+</button>
      </div>

      <button (click)="remove(e)">Remover</button>
    </div>

    <div class="cart-total">
      <strong>Total: R$ {{ (total$ | async) | number:'1.2-2' }}</strong>
    </div>

    <div class="cart-actions">
      <button (click)="clear()"  class="btn-clear" [disabled]="!items?.length">Limpar carrinho</button>
      <button (click)="comprarTodos()" class="btn-primary" [disabled]="!items?.length || !estaLogado">Finalizar compra</button>
      <p *ngIf="!estaLogado && items?.length">Faça login para finalizar a compra.</p>
    </div>
  </div>
  <ng-template #empty><p>Carregando...</p></ng-template>
</section>
